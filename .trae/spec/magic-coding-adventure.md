# 魔法编程冒险 (Magic Coding Adventure) - 设计规格说明书

## 1. 项目概述
**项目名称**: Magic Coding Adventure (原型)
**托管平台**: GitHub Pages (静态网站)
**核心理念**: 将"编译原理"的概念趣味化，融入回合制文字冒险游戏。玩家在战前像编写程序一样组合"符文"，在伪即时战斗中进行"编译执行"。
**技术栈**:
- **核心**: HTML5, CSS3, TypeScript (ES6+)
- **构建工具**: Vite
- **测试框架**: Vitest
- **代码规范**: ESLint + Prettier
- **数据**: TypeScript 类型定义 + JSON 对象
- **存储**: LocalStorage (存档/读档)

## 2. 核心玩法循环

### 2.1 阶段一：营地构建 (Preparation Phase)
- **场景**: 酒馆、篝火等安全区域。
- **操作**:
  - 玩家拥有有限的**法术卡槽 (Spell Slots)**。
  - 从**符文库 (Rune Library)** 中拖拽/点击符文填入卡槽。
  - **实时预览**: 界面实时计算并显示组合后的总耗蓝 (MP)、总吟唱时间 (Time)、预估伤害/效果。
- **限制**:
  - 卡槽数量随等级解锁。
  - **战斗中不可修改**，必须在营地预设。

### 2.2 阶段二：伪即时战斗 (Pseudo-Real-Time Combat)
- **机制**: **ATB (Active Time Battle) 行动条**。
  - 所有单位（玩家/敌人）根据 `Speed` 属性实时填充行动条。
  - 行动条满 (100%) -> 进入 **就绪状态 (Ready)** -> 时间暂停/慢放 -> 玩家选择法术。
- **施法与打断 (Cast & Interrupt)**:
  - 玩家选择法术后，进入 **吟唱状态 (Casting)**。
  - **吟唱条**: 独立进度条，耗时取决于法术组合的总时间。
  - **风险**: 吟唱期间，敌人行动条继续增长。若敌人先出手攻击，玩家有概率被**打断 (Interrupt)**。
    - *打断后果*: 法术失效，消耗部分 MP，角色陷入硬直。
  - **策略**: 速度越快 vs 吟唱时间越短 = 更安全；伤害越高 vs 吟唱时间越长 = 风险越大。

## 3. 魔法编程系统 (Magic Programming System)

### 3.1 符文分类 (Token Types)
系统不采用严格的编译报错，而是采用"积木式"逻辑，强调组合乐趣。

| 类型 | 名称示例 | 作用 | 属性示例 |
| :--- | :--- | :--- | :--- |
| **核心符 (Core)** | 火球术, 治疗术 | 定义法术的基础效果 | `BaseDmg`, `BaseHeal`, `BaseCost`, `BaseTime` |
| **修饰符 (Mod)** | 强化, 迅捷, 双重 | 改变紧随其后的核心符属性 | `DmgMult` (x1.5), `TimeMult` (x0.6), `Count` (x2) |
| **控制符 (Control)** | (预留) | 改变执行流程 (如条件施法) | - |

### 3.2 组合逻辑
- **顺序敏感**: `[强化] + [火球]` ≠ `[火球] + [强化]`。
  - 规则约定：修饰符需置于核心符之前生效。
- **自动计算**:
  - `TotalCost = Sum(RuneCost * Modifiers)`
  - `TotalTime = Sum(RuneTime * Modifiers)`
  - `Effect = BaseEffect * Modifiers`

## 4. 数据结构设计

### 4.1 符文定义 (Runes)
```json
{
  "firebolt": {
    "id": "firebolt",
    "name": "火球术",
    "type": "CORE",
    "icon": "🔥",
    "baseDmg": 25,
    "cost": 10,
    "time": 1.5
  },
  "amp": {
    "id": "amp",
    "name": "强化",
    "type": "MOD",
    "icon": "⚡",
    "dmgMult": 1.5,
    "costMult": 1.3,
    "timeAdd": 0.5
  }
}
```

## 5. 界面设计
- **顶部状态栏**: 显示玩家 HP/MP、场景标题
- **主场景区域**: 战斗场景或营地场景
- **底部控制区**: 营地编辑器或战斗操作区
- **战斗日志**: 显示战斗过程中的事件

## 6. 核心功能
- **符文组合系统**: 允许玩家在营地中组合不同的符文创建法术
- **ATB战斗系统**: 基于速度属性的伪即时战斗
- **施法与打断机制**: 吟唱过程中可能被敌人打断
- **状态管理**: 包括就绪、吟唱、硬直等状态
- **战斗日志**: 记录战斗过程中的关键事件

## 7. 技术实现要点
- 使用 TypeScript 实现游戏逻辑，提供类型安全
- 使用 CSS 变量管理颜色主题
- 使用 requestAnimationFrame 实现平滑的动画效果
- 使用 LocalStorage 存储游戏进度
- 模块化设计，将逻辑分为 engine、ui、storage 等模块
- 使用 Vite 作为构建工具，提供热更新和优化
- 使用 Vitest 进行单元测试和集成测试
- 使用 ESLint 和 Prettier 确保代码质量
- 响应式设计，适配不同屏幕尺寸

## 8. 游戏流程
1. 玩家进入营地场景
2. 在营地中配置法术组合
3. 离开营地，随机遭遇敌人
4. 进入战斗场景，使用配置好的法术战斗
5. 战斗胜利或失败后返回营地
6. 重复上述流程

## 9. 未来扩展方向
- 添加更多类型的符文
- 实现升级系统，解锁更多法术槽位
- 添加装备系统，影响角色属性
- 增加剧情内容，丰富游戏体验
- 实现存档系统，保存游戏进度